<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>WebSocket Example</title>
	</head>
	<body>
		<h1>WebSocket</h1>
		<input type="text" id="nameInput" placeholder="Enter your name">
		<button id="sendNameButton" onclick="sendName()">Send Name</button><br></br>
		<div id="messages"></div>
		<input type="text" id="messageInput" placeholder="Type a message">
		<button id="sendButton" onclick="sendMessage()">Send</button>

		<script>
			let socket;

			function sendName() {
				const nameInput = document.getElementById('nameInput');
                                const name = nameInput.value;
                                console.log(name);

				if (name.trim() === "") {
                                        alert("Please enter a username");
                                        return;
                                }

				socket = new WebSocket(`ws://localhost:5000/?username=${encodeURIComponent(name)}`);
				
				socket.addEventListener('open', function (event) {
                                        console.log('Connected to Websocket server');
	                        });

        	                socket.addEventListener('message', function handleMessage(event) {
                	                console.log(event.data);
                	                const messagesDiv = document.getElementById('messages');
                	                messagesDiv.innerHTML += '<p>' + event.data + '</p>';
                        	});

                        	socket.addEventListener('close', function (event) {
                        	        console.log('Connection to WebSocket server closed');
                        	});
	
        	                socket.addEventListener('error', function (event) {
                	                console.error('WebSocket error:', event);
                        	});

			}

			function sendMessage() {
				if (!socket || socket.readyState !== WebSocket.OPEN) {
        				console.error("WebSocket connection is not open.");
        				return;
    				}

    				const messageInput = document.getElementById("messageInput");
				const message = messageInput.value;
    				if (!message) {
        				console.error("Please enter a message.");
        				return;
    				}

    				socket.send(message);
				console.log(message);
				messageInput.value = '';
			}
		</script>
	</body>
</html>
